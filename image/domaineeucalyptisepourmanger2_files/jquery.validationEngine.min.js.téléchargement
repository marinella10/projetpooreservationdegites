!function(e){var a={init:function(t){var r=this;r.data("jqv")&&null!=r.data("jqv")||(a._saveOptions(r,t),e(".formError").live("click",function(){e(this).fadeOut(150,function(){e(this).remove()})}))},attach:function(e){var t,r=this;t=e?a._saveOptions(r,e):r.data("jqv");r.find("[data-validation-engine*=validate]")?"data-validation-engine":"class";t.binded||("bind"==t.bindMethod?(r.find("[class*=validate]:not([type=checkbox])").bind(t.validationEventTrigger,a._onFieldEvent),r.find("[class*=validate][type=checkbox]").bind("click",a._onFieldEvent),r.bind("submit",a._onSubmitEvent)):"live"==t.bindMethod&&(r.find("[class*=validate]:not([type=checkbox])").live(t.validationEventTrigger,a._onFieldEvent),r.find("[class*=validate][type=checkbox]").live("click",a._onFieldEvent),r.live("submit",a._onSubmitEvent)),t.binded=!0)},detach:function(){var e=this,t=e.data("jqv");t.binded&&(e.find("[class*=validate]").not("[type=checkbox]").unbind(t.validationEventTrigger,a._onFieldEvent),e.find("[class*=validate][type=checkbox]").unbind("click",a._onFieldEvent),e.unbind("submit",a.onAjaxFormComplete),e.find("[class*=validate]").not("[type=checkbox]").die(t.validationEventTrigger,a._onFieldEvent),e.find("[class*=validate][type=checkbox]").die("click",a._onFieldEvent),e.die("submit",a.onAjaxFormComplete),e.removeData("jqv"))},validate:function(){return a._validateFields(this)},validateField:function(t){var r=e(this).data("jqv");return a._validateField(e(t),r)},validateform:function(){return a._onSubmitEvent.call(this)},showPrompt:function(e,t,r,i){var o=this.closest("form"),l=o.data("jqv");l||(l=a._saveOptions(this,l)),r&&(l.promptPosition=r),l.showArrow=1==i,a._showPrompt(this,e,t,!1,l)},hidePrompt:function(){var t="."+a._getClassName(e(this).attr("id"))+"formError";e(t).fadeTo("fast",.3,function(){e(this).remove()})},hide:function(){var a;a=e(this).is("form")?"parentForm"+e(this).attr("id"):e(this).attr("id")+"formError",e("."+a).fadeTo("fast",.3,function(){e(this).remove()})},hideAll:function(){e(".formError").fadeTo("fast",.3,function(){e(this).remove()})},_onFieldEvent:function(){var t=e(this),r=t.closest("form"),i=r.data("jqv");a._validateField(t,i)},_onSubmitEvent:function(){var t=e(this),r=t.data("jqv"),i=a._validateFields(t,!0);return i&&r.ajaxFormValidation?(a._validateFormWithAjax(t,r),!1):r.onValidationComplete?(r.onValidationComplete(t,i),!1):i},_checkAjaxStatus:function(a){var t=!0;return e.each(a.ajaxValidCache,function(e,a){return a?void 0:(t=!1,!1)}),t},_validateFields:function(t,r){var i=t.data("jqv"),o=!1;if(t.trigger("jqv.form.validating"),t.find("[class*=validate]").not(":hidden").each(function(){var t=e(this);o|=a._validateField(t,i,r)}),t.trigger("jqv.form.result",[o]),o){if(i.scroll){for(var l=Number.MAX_VALUE,n=0,s=e(".formError:not('.greenPopup')"),d=0;d<s.length;d++){var c=e(s[d]).offset().top;l>c&&(l=c,n=e(s[d]).offset().left)}if(i.isOverflown){var v=e(i.overflownDIV),u=v.scrollTop(),f=-parseInt(v.offset().top);l+=u+f-5;var m=e(i.overflownDIV+":not(:animated)");m.animate({scrollTop:l},1100),e("html:not(:animated),body:not(:animated)").animate({scrollTop:v.offset().top,scrollLeft:n},1100)}else e("html:not(:animated),body:not(:animated)").animate({scrollTop:l,scrollLeft:n},1100)}return!1}return!0},_validateFormWithAjax:function(t,r){var i=t.serialize(),o=r.ajaxFormValidationURL?r.ajaxFormValidationURL:t.attr("action"),l=r.dataTypeAjaxFormResponse;e.ajax({type:"GET",url:o,cache:!1,dataType:l,data:i,form:t,methods:a,options:r,beforeSend:function(){return r.onBeforeAjaxFormValidation(t,r)},error:function(e,t){a._ajaxError(e,t)},success:function(i){var o=r.dataTypeAjaxFormResponse;if("json"==o)if(i!==!0){for(var l=!1,n=0;n<i.length;n++){var s=i[n],d=s[0],c=e(e("#"+d)[0]);if(1==c.length){var v=s[2];if(1==s[1])if(""!=v&&v){if(r.allrules[v]){var u=r.allrules[v].alertTextOk;u&&(v=u)}a._showPrompt(c,v,"pass",!1,r,!0)}else a._closePrompt(c);else{if(l|=!0,r.allrules[v]){var u=r.allrules[v].alertText;u&&(v=u)}a._showPrompt(c,v,"",!1,r,!0)}}}r.onAjaxFormComplete(!l,t,i,r)}else r.onAjaxFormComplete(!0,t,"",r);else r.onAjaxFormComplete(t,i)}})},_validateField:function(t,r,i){t.attr("id")||e.error("jQueryValidate: an ID attribute is required for this field: "+t.attr("name")+" class:"+t.attr("class"));var o=t.attr("class"),l=/validate\[(.*)\]/.exec(o);if(!l)return!1;var n=l[1],s=n.split(/\[|,|\]/),d=!1,c=t.attr("name"),v="",u=!1;r.isError=!1,r.showArrow=!0;for(var f=0;f<s.length;f++){var m=void 0;switch(s[f]){case"required":u=!0,m=a._required(t,s,f,r);break;case"custom":m=a._customRegex(t,s,f,r);break;case"ajax":i||(a._ajax(t,s,f,r),d=!0);break;case"minSize":m=a._minSize(t,s,f,r);break;case"maxSize":m=a._maxSize(t,s,f,r);break;case"min":m=a._min(t,s,f,r);break;case"max":m=a._max(t,s,f,r);break;case"past":m=a._past(t,s,f,r);break;case"future":m=a._future(t,s,f,r);break;case"maxCheckbox":m=a._maxCheckbox(t,s,f,r),t=e(e("input[name='"+c+"']"));break;case"minCheckbox":m=a._minCheckbox(t,s,f,r),t=e(e("input[name='"+c+"']"));break;case"equals":m=a._equals(t,s,f,r);break;case"funcCall":m=a._funcCall(t,s,f,r)}void 0!==m&&(v+=m+"<br/>",r.isError=!0)}u||""==t.val()&&(r.isError=!1);var p=t.attr("type");return("radio"==p||"checkbox"==p)&&e("input[name='"+c+"']").size()>1&&(t=e(e("input[name='"+c+"'][type!=hidden]:first")),r.showArrow=!1),r.isError?a._showPrompt(t,v,"",!1,r):d||a._closePrompt(t),t.trigger("jqv.field.result",[t,r.isError,v]),r.isError},_required:function(a,t,r,i){switch(a.attr("type")){case"text":case"password":case"textarea":case"file":default:if(!a.val())return i.allrules[t[r]].alertText;break;case"radio":case"checkbox":var o=a.attr("name");if(0==e("input[name='"+o+"']:checked").size())return 1==e("input[name='"+o+"']").size()?i.allrules[t[r]].alertTextCheckboxe:i.allrules[t[r]].alertTextCheckboxMultiple;break;case"select-one":if(!a.val())return i.allrules[t[r]].alertText;break;case"select-multiple":if(!a.find("option:selected").val())return i.allrules[t[r]].alertText}},_customRegex:function(e,a,t,r){var i=a[t+1],o=r.allrules[i];if(!o)return void alert("jqv:custom rule not found "+i);var l=o.regex;if(!l)return void alert("jqv:custom regex not found "+i);var n=new RegExp(l);return n.test(e.val())?void 0:r.allrules[i].alertText},_funcCall:function(e,a,t,r){var i=a[t+1],o=window[i];return"function"==typeof o?o(e,a,t,r):void 0},_equals:function(a,t,r,i){var o=t[r+1];return a.val()!=e("#"+o).val()?i.allrules.equals.alertText:void 0},_maxSize:function(e,a,t,r){var i=a[t+1],o=e.val().length;if(o>i){var l=r.allrules.maxSize;return l.alertText+i+l.alertText2}},_minSize:function(e,a,t,r){var i=a[t+1],o=e.val().length;if(i>o){var l=r.allrules.minSize;return l.alertText+i+l.alertText2}},_min:function(e,a,t,r){var i=parseFloat(a[t+1]),o=parseFloat(e.val());if(i>o){var l=r.allrules.min;return l.alertText2?l.alertText+i+l.alertText2:l.alertText+i}},_max:function(e,a,t,r){var i=parseFloat(a[t+1]),o=parseFloat(e.val());if(o>i){var l=r.allrules.max;return l.alertText2?l.alertText+i+l.alertText2:l.alertText+i}},_past:function(e,t,r,i){var o=t[r+1],l="now"==o.toLowerCase()?new Date:a._parseDate(o),n=a._parseDate(e.val());if(l>n){var s=i.allrules.past;return s.alertText2?s.alertText+a._dateToString(l)+s.alertText2:s.alertText+a._dateToString(l)}},_future:function(e,t,r,i){var o=t[r+1],l="now"==o.toLowerCase()?new Date:a._parseDate(o),n=a._parseDate(e.val());if(n>l){var s=i.allrules.future;return s.alertText2?s.alertText+a._dateToString(l)+s.alertText2:s.alertText+a._dateToString(l)}},_maxCheckbox:function(a,t,r,i){var o=t[r+1],l=a.attr("name"),n=e("input[name='"+l+"']:checked").size();return n>o?(i.showArrow=!1,i.allrules.maxCheckbox.alertText2?i.allrules.maxCheckbox.alertText+" "+o+" "+i.allrules.maxCheckbox.alertText2:i.allrules.maxCheckbox.alertText):void 0},_minCheckbox:function(a,t,r,i){var o=t[r+1],l=a.attr("name"),n=e("input[name='"+l+"']:checked").size();return o>n?(i.showArrow=!1,i.allrules.minCheckbox.alertText+" "+o+" "+i.allrules.minCheckbox.alertText2):void 0},_ajax:function(t,r,i,o){var l=r[i+1],n=o.allrules[l],s=n.extraData,d=n.extraDataDynamic;if(s||(s=""),d){for(var c=[],v=String(d).split(","),i=0;i<v.length;i++){var u=v[i];if(e(u).length){var f=t.closest("form").find(u).val(),m=u.replace("#","")+"="+escape(f);c.push(m)}}d=c.join("&")}else d="";o.isError||e.ajax({type:"GET",url:n.url,cache:!1,dataType:"json",data:"fieldId="+t.attr("id")+"&fieldValue="+t.val()+"&extraData="+s+"&"+d,field:t,rule:n,methods:a,options:o,beforeSend:function(){var e=n.alertTextLoad;e&&a._showPrompt(t,e,"load",!0,o)},error:function(e,t){a._ajaxError(e,t)},success:function(t){var r=t[0],i=e(e("#"+r)[0]);if(1==i.length){var l=t[1],s=t[2];if(l){if(void 0!==o.ajaxValidCache[r]&&(o.ajaxValidCache[r]=!0),s){if(o.allrules[s]){var d=o.allrules[s].alertTextOk;d&&(s=d)}}else s=n.alertTextOk;s?a._showPrompt(i,s,"pass",!0,o):a._closePrompt(i)}else{if(o.ajaxValidCache[r]=!1,o.isError=!0,s){if(o.allrules[s]){var d=o.allrules[s].alertText;d&&(s=d)}}else s=n.alertText;a._showPrompt(i,s,"",!0,o)}}}})},_ajaxError:function(e,a){0==e.status&&null==a?alert("The page is not served from a server! ajax call failed"):"undefined"!=typeof console&&console.log("Ajax error: "+e.status+" "+a)},_dateToString:function(e){return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()},_parseDate:function(e){var a=e.split("-");return a==e&&(a=e.split("/")),new Date(a[0],a[1]-1,a[2])},_showPrompt:function(e,t,r,i,o,l){var n=a._getPrompt(e);l&&(n=!1),n?a._updatePrompt(e,n,t,r,i,o):a._buildPrompt(e,t,r,i,o)},_buildPrompt:function(t,r,i,o,l){var n=e("<div>");switch(n.addClass(a._getClassName(t.attr("id"))+"formError"),t.is(":input")&&n.addClass("parentForm"+a._getClassName(t.parents("form").attr("id"))),n.addClass("formError"),i){case"pass":n.addClass("greenPopup");break;case"load":n.addClass("blackPopup")}o&&n.addClass("ajaxed");e("<div>").addClass("formErrorContent").html(r).appendTo(n);if(l.showArrow){var s=e("<div>").addClass("formErrorArrow");switch(l.promptPosition){case"bottomLeft":case"bottomRight":n.find(".formErrorContent").before(s),s.addClass("formErrorArrowBottom").html('<div class="line1"><!-- --></div><div class="line2"><!-- --></div><div class="line3"><!-- --></div><div class="line4"><!-- --></div><div class="line5"><!-- --></div><div class="line6"><!-- --></div><div class="line7"><!-- --></div><div class="line8"><!-- --></div><div class="line9"><!-- --></div><div class="line10"><!-- --></div>');break;case"topLeft":case"topRight":s.html('<div class="line10"><!-- --></div><div class="line9"><!-- --></div><div class="line8"><!-- --></div><div class="line7"><!-- --></div><div class="line6"><!-- --></div><div class="line5"><!-- --></div><div class="line4"><!-- --></div><div class="line3"><!-- --></div><div class="line2"><!-- --></div><div class="line1"><!-- --></div>'),n.append(s)}}l.isOverflown?t.before(n):e("body").append(n);var d=a._calculatePosition(t,n,l);return n.css({top:d.callerTopPosition,left:d.callerleftPosition,marginTop:d.marginTopSize,opacity:0}),n.animate({opacity:.87})},_updatePrompt:function(e,t,r,i,o,l){if(t){"pass"==i?t.addClass("greenPopup"):t.removeClass("greenPopup"),"load"==i?t.addClass("blackPopup"):t.removeClass("blackPopup"),o?t.addClass("ajaxed"):t.removeClass("ajaxed"),t.find(".formErrorContent").html(r);var n=a._calculatePosition(e,t,l);t.animate({top:n.callerTopPosition,marginTop:n.marginTopSize})}},_closePrompt:function(e){var t=a._getPrompt(e);t&&t.fadeTo("fast",0,function(){t.remove()})},closePrompt:function(e){return a._closePrompt(e)},_getPrompt:function(t){var r="."+a._getClassName(t.attr("id"))+"formError",i=e(r)[0];return i?e(i):void 0},_calculatePosition:function(e,a,t){var r,i,o,l=e.width(),n=a.height(),s=t.isOverflown;if(s)r=i=0,o=-n;else{var d=e.offset();r=d.top,i=d.left,o=0}switch(t.promptPosition){default:case"topRight":s?i+=l-30:(i+=l-30,r+=-n);break;case"topLeft":r+=-n-10;break;case"centerRight":i+=l+13;break;case"bottomLeft":r=r+e.height()+15;break;case"bottomRight":i+=l-30,r+=e.height()+5}return{callerTopPosition:r+"px",callerleftPosition:i+"px",marginTopSize:o+"px"}},_saveOptions:function(a,t){if(e.validationEngineLanguage)var r=e.validationEngineLanguage.allRules;else e.error("jQuery.validationEngine rules are not loaded, plz add localization files to the page");var i=e.extend({validationEventTrigger:"blur",scroll:!0,promptPosition:"topRight",bindMethod:"bind",inlineAjax:!1,ajaxFormValidation:!1,ajaxFormValidationURL:!1,onAjaxFormComplete:e.noop,onBeforeAjaxFormValidation:e.noop,onValidationComplete:!1,isOverflown:!1,overflownDIV:"",dataTypeAjaxFormResponse:"json",allrules:r,binded:!1,showArrow:!0,isError:!1,ajaxValidCache:{}},t);return a.data("jqv",i),i},_getClassName:function(e){return e.replace(":","_").replace(".","_")}};e.fn.validationEngine=function(t){var r=e(this);return r[0]?"string"==typeof t&&"_"!=t.charAt(0)&&a[t]?("showPrompt"!=t&&"hidePrompt"!=t&&"hide"!=t&&"hideAll"!=t&&a.init.apply(r),a[t].apply(r,Array.prototype.slice.call(arguments,1))):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist in jQuery.validationEngine"):(a.init.apply(r,arguments),a.attach.apply(r)):!1}}(jQuery);